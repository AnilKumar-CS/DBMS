show databases;

create database Anil;
use anil;

create table supplier(
sid int primary key,
sname varchar(30),
city varchar(30)
);

desc supplier;

insert into supplier values(10001, "Acme widget","Bangalore");
insert into supplier values(10002, "johns","Kolkata");
insert into supplier values(10003, "vimal","Mumbai");
insert into supplier values(10004, "Relience","Delhi");

select * from supplier;

create table parts(
pid int primary key,
pname varchar(30),
colour varchar(30)
);

desc parts;

insert into parts values(20001, "Book", "Red");
insert into parts values(20002, "pen", "Red");
insert into parts values(20003, "Pencil", "Green");
insert into parts values(20004, "Mobile", "Green");
insert into parts values(20005, "Charger", "Black");

select * from parts;

create table catalog(
sid int,
pid int,
cost int,
foreign key(sid) references supplier(sid),
foreign key(pid) references parts(pid)
);

desc catalog;

insert into catalog values(10001, 20001, 10);
insert into catalog values(10001, 20002, 10);
insert into catalog values(10001, 20003, 30);
insert into catalog values(10001, 20004, 10);
insert into catalog values(10001, 20005, 10);
insert into catalog values(10002, 20001, 10);
insert into catalog values(10002, 20002, 20);
insert into catalog values(10003, 20003, 30);
insert into catalog values(10004, 20003, 40);

select * from catalog;

SELECT DISTINCT p.pname FROM parts p JOIN catalog c ON p.pid = c.pid JOIN supplier s ON c.sid = s.sid;

SELECT s.sname FROM supplier s JOIN catalog c ON s.sid = c.sid GROUP BY s.sid
HAVING COUNT(DISTINCT c.pid) = (SELECT COUNT(*) FROM parts);

SELECT s.sname FROM supplier s JOIN catalog c ON s.sid = c.sid JOIN parts p ON c.pid = p.pid
WHERE p.colour = 'Red' GROUP BY s.sid
HAVING COUNT(DISTINCT c.pid) = (SELECT COUNT(*) FROM parts WHERE colour = 'Red');

SELECT p.pname FROM parts p JOIN catalog c ON p.pid = c.pid WHERE c.sid = 10001 
AND NOT EXISTS (
SELECT 1 FROM catalog c2 WHERE c2.pid = p.pid AND c2.sid != 10001 
);

SELECT c.sid FROM catalog c
JOIN (
    SELECT pid, AVG(cost) AS avg_cost
    FROM catalog
    GROUP BY pid
) avg_costs ON c.pid = avg_costs.pid WHERE c.cost > avg_costs.avg_cost;


SELECT s.sname, c.pid, c.cost FROM catalog c JOIN supplier s ON c.sid = s.sid
WHERE (c.pid, c.cost) IN (
    SELECT pid, MAX(cost)
    FROM catalog
    GROUP BY pid
);

select s.sname, p.pname, c.cost from supplier s join catalog c on s.sid=c.sid
join parts p on p.pid = c.pid 
where c.cost = (select max(cost) from catalog);

select s.sname from supplier s
where s.sid not in(select distinct c.sid from catalog c join 
parts p on c.pid=p.pid where p.colour = "Red ");

select s.sname, sum(c.cost) as total from supplier s join catalog c on s.sid = c.sid
group by s.sname;

select s.sname
from supplier s
join catalog c on s.sid = c.sid
where c.cost < 20
group by s.sname
having COUNT(c.pid) >= 2;

select s.sname, p.pname, c.cost
from supplier s
join catalog c on s.sid = c.sid
join parts p on c.pid = p.pid
where c.cost = (
    select MIN(c2.cost)
    from catalog c2
    where c2.pid = c.pid
);


create view supplier_part_count as
select s.sid, s.sname, COUNT(c.pid) as total_parts
from supplier s
join catalog c on s.sid = c.sid
group by c.sid, s.sname;
select * from supplier_part_count;

create view most_expensive_supplier as
select  p.pid, p.pname, s.sname, c.cost
from supplier s join catalog c on s.sid = c.sid
join parts p on c.pid = p.pid
where c.cost = (
    select max(c2.cost)
    from catalog c2
    where c2.pid = c.pid
);
select * from most_expensive_supplier;

DELIMITER \\

CREATE TRIGGER low_cost
BEFORE INSERT ON catalog
FOR EACH ROW
BEGIN
    IF NEW.cost < 1 THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'Error! Cost cannot be less than 1';
    END IF;
END\\

DELIMITER ;












 
